repositories:
  - name: argo
    url: https://argoproj.github.io/argo-helm

releases:
  - name: argocd
    namespace: argocd
    chart: argo/argo-cd
    version: 8.0.9
    values:
      - configs:
          cm:
            kustomize.buildOptions: --enable-helm
  - name: root
    namespace: argocd
    chart: argo/argocd-apps
    version: 2.0.2
    values:
      - applicationsets:
          root:
            namespace: argocd
            generators:
              - git:
                repoURL: https://github.com/koyashiro/k8s-manifests.git
                revision: HEAD
                directories:
                  - path: applications/*
            template:
              metadata:
                name: "{path.basename}"
                namespace: argocd
              spec:
                project: default
                sources:
                  - repoURL: https://github.com/koyashiro/k8s-manifests.git
                    targetRevision: HEAD
                    path: "{{path}}"
                destination:
                  server: https://kubernetes.default.svc
                  namespace: argocd
              syncPolicy:
                automated:
                  selfHeal: true
                  prune: true
                syncOptions:
                  - CreateNamespace=true
